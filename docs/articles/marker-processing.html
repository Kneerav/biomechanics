<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Processing 3D marker data • biomechanics</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Processing 3D marker data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">biomechanics</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/marker-processing.html">Processing 3D marker data</a></li>
    <li><a class="dropdown-item" href="../articles/setting-up.html">Setting up for biomechanical analysis</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Kneerav/biomechanics/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="marker-processing_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="marker-processing_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="marker-processing_files/plotly-binding-4.11.0/plotly.js"></script><script src="marker-processing_files/typedarray-0.1/typedarray.min.js"></script><link href="marker-processing_files/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet">
<script src="marker-processing_files/crosstalk-1.2.2/js/crosstalk.min.js"></script><link href="marker-processing_files/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="marker-processing_files/plotly-main-2.11.1/plotly-latest.min.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Processing 3D marker data</h1>
                        <h4 data-toc-skip class="author">Nirav
Maniar</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Kneerav/biomechanics/blob/HEAD/vignettes/marker-processing.Rmd" class="external-link"><code>vignettes/marker-processing.Rmd</code></a></small>
      <div class="d-none name"><code>marker-processing.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Kneerav/biomechanics" class="external-link">biomechanics</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: replacing previous import 'ggplot2::last_plot' by 'plotly::last_plot'</span></span>
<span><span class="co">#&gt; when loading 'biomechanics'</span></span></code></pre></div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>Processing marker data involves the following steps:</p>
<ul>
<li>Rotating data so that positive x, y, and z axis point towards
forward, up, and to the right, respectively</li>
<li>Filtering the data (usually with a cut-off of 6-20Hz)</li>
<li>Computing virtual markers</li>
<li>Writing the marker data to a .trc file</li>
</ul>
<p>Noting that filtering data is not really necessary for a static trial
(where the participant is not moving), and that virtual markers are not
necessary in all cases (particularly dynamic trials).</p>
<p>For the following example, we assume that we have extracted and
clipped the data (no rotations applied yet).</p>
</div>
<div class="section level2">
<h2 id="reading-data">Reading data<a class="anchor" aria-label="anchor" href="#reading-data"></a>
</h2>
<p>First, we read a .trc file.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'dplyr' was built under R version 4.2.3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span></span>
<span><span class="co">#read in trc file, assuming that this is raw and not rotated</span></span>
<span><span class="va">df</span> <span class="op">=</span> <span class="fu"><a href="../reference/read_trc.html">read_trc</a></span><span class="op">(</span><span class="st">"./data/static_z_up.trc"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualise">Visualise<a class="anchor" aria-label="anchor" href="#visualise"></a>
</h2>
<p>We can create a 3D visual for a specified frame. Here, we can see
that the orientation of the data appears incorrect. This is because
motion capture systems typically have a “Z-up” coordinate system, but
OpenSim expects a “Y-up”.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#quick visual to check</span></span>
<span><span class="fu"><a href="../reference/visualise_3D_marker_position.html">visualise_3D_marker_position</a></span><span class="op">(</span><span class="va">df</span>, selected_frame <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: plotly</span></span>
<span><span class="co">#&gt; Loading required package: ggplot2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'plotly'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:ggplot2':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     last_plot</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:graphics':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     layout</span></span></code></pre></div>
<div class="plotly html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"visdat":{"42a0180174ea":["function () ","plotlyVisDat"]},"cur_data":"42a0180174ea","attrs":{"42a0180174ea":{"x":{},"y":{},"z":{},"hoverinfo":"text+x+z+y","mode":"markers","text":{},"marker":{"size":3,"color":"#024950"},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Anterior-Posterior","range":[-120.29093170166,1412.03784179688]},"yaxis":{"title":"Mediolateral","range":[1412.03784179688,-120.29093170166]},"zaxis":{"title":"Vertical","range":[-120.29093170166,1412.03784179688]},"aspectmode":"cube"},"title":"3D Marker Positions at Frame = 1","hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[238.25479125976599,235.24496459960901,237.01898193359401,116.774452209473,335.98495483398398,186.92631530761699,268.10653686523398,55.517581939697202,58.519828796386697,-38.932117462158303,-120.29093170166,-60.5750122070313,421.04357910156301,414.08761596679699,520.30938720703102,519.73907470703102,588.47613525390602,55.533702850341797,40.666255950927699,61.859527587890597,43.265460968017599,176.39555358886699,60.875759124755902,45.855239868164098,46.9469604492188,47.146755218505902,48.816547393798899,139.54537963867199,49.983097076416001,101.363075256348,97.498970031738295,138.67967224121099,56.675041198730497,138.42251586914099,88.612152099609403,33.348724365234403,119.496627807617,86.237030029296903,21.763154983520501,80.748817443847699,390.03793334961,419.02359008789102,406.19113159179699,419.68347167968801,291.99075317382801,407.27233886718801,407.132904052735,423.40570068359398,388.61358642578102,411.31622314453102,317.13037109375,402.02996826171898,349.5078125,352.38031005859398,305.35443115234398,396.33352661132801,312.27658081054699,362.808837890625,416.69842529296898,325.21231079101602,369.29367065429699,433.21539306640602,371.318603515625],"y":[1412.03784179688,1355.09265136719,1256.25268554688,946.86315917968795,949.48553466796898,970.767333984375,967.881591796875,1398.58557128906,1082.09765625,1124.66320800781,911.07092285156295,873.24493408203205,1382.70532226562,1063.12915039062,1093.96459960938,848.03656005859398,879.86267089843795,701.79016113281295,700.12951660156295,597.67053222656295,611.81024169921898,480.51205444336,502.75552368164102,309.53164672851602,297.77801513671898,248.29714965820301,220.15455627441401,113.995971679688,101.20957183837901,79.986717224121094,49.2211303710938,49.592823028564503,44.946666717529297,88.507293701171903,109.901802062988,84.849037170410199,62.235408782958999,74.757759094238295,59.005619049072301,68.022621154785199,711.35925292968795,708.49938964843795,625.92706298828102,603.06359863281295,484.42889404296898,494.01553344726602,271.75967407226602,287.07168579101602,210.99147033691401,206.94834899902401,121.56436920166,109.546684265137,84.051643371582102,47.884109497070298,39.731842041015703,47.443809509277401,87.916534423828196,108.60043334960901,84.176170349121193,65.116188049316406,77.334030151367202,46.243667602539098,71.239822387695398],"z":[156.43150329589801,310.48590087890602,113.78587341308599,305.8115234375,307.44198608398398,141.16725158691401,140.521728515625,222.37440490722699,244.06571960449199,219.17793273925801,289.45220947265602,246.64465332031301,217.74491882324199,244.63612365722699,219.28791809082,253.13104248046901,289.64440917968801,197.00053405761699,270.55255126953102,193.930740356445,256.62149047851602,257.42620849609398,218.81057739257801,153.14454650878901,233.98571777343801,156.48066711425801,217.30862426757801,201.59925842285199,182.16773986816401,117.186897277832,111.81329345703099,144.31982421875,132.94874572753901,243.883712768555,277.57638549804699,221.211669921875,328.52151489257801,335.92050170898398,316.09970092773398,374.5380859375,175.03112792968801,244.29455566406301,181.15765380859401,239.72515869140599,246.56320190429699,217.20491027832,141.92227172851599,204.34007263183599,135.68739318847699,207.55572509765599,202.58120727539099,175.18406677246099,120.55532073974599,113.28782653808599,159.95495605468801,142.09500122070301,241.91552734375,280.81246948242199,225.15718078613301,319.08917236328102,328.90887451171898,294.73236083984398,373.32669067382801],"hoverinfo":["text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y"],"mode":"markers","text":["C7","Sternum","MidT","L.ASIS","R.ASIS","L.PSIS","R.PSIS","L.Acromion","L.Elbow.Med","L.Elbow.Lat","L.Radius","L.Ulna","R.Acromion","R.Elbow.Med","R.Elbow.Lat","R.Ulna","R.Radius","L.Thigh.Post.Sup","L.Thigh.Ant.Sup","L.Thigh.Post.Inf","L.Thigh.Ant.Inf","L.Knee.Med","L.Knee.Lat","L.Shank.Post.Sup","L.Shank.Ant.Sup","L.Shank.Post.Inf","L.Shank.Ant.Inf","L.Ankle.Med","L.Ankle.Lat","L.Heel.Sup","L.Heel.Inf","L.Heel. Med","L.Heel.Lat","L.Midfoot.Med","L.Midfoot.Int","L.Midfoot.Lat","L.MTP1","L.MTP2","L.MTP5","L.Toe","R.Thigh.Post.Sup","R.Thigh.Ant.Sup","R.Thigh.Post.Inf","R.Thigh.Ant.Inf","R.Knee.Med","R.Knee.Lat","R.Shank.Post.Sup","R.Shank.Ant.Sup","R.Shank.Post.Inf","R.Shank.Ant.Inf","R.Ankle.Med","R.Ankle.Lat","R.Heel.Sup","R.Heel.Inf","R.Heel.Med","R.Heel.Lat","R.Midfoot.Med","R.Midfoot.Int","R.Midfoot.Lat","R.MTP1","R.MTP2","R.MTP5","R.Toe"],"marker":{"color":"#024950","size":3,"line":{"color":"rgba(31,119,180,1)"}},"type":"scatter3d","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level2">
<h2 id="rotate">Rotate<a class="anchor" aria-label="anchor" href="#rotate"></a>
</h2>
<p>We can rotate our data using the <code><a href="../reference/rotate_markers.html">rotate_markers()</a></code>
function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#now rotate to OpenSim coordinate system (if needed)</span></span>
<span><span class="va">df_rotated</span> <span class="op">=</span> </span>
<span>  </span>
<span>  <span class="co">#raw data</span></span>
<span>  <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="co">#rotate anti-clockwise around z axis</span></span>
<span>  <span class="fu"><a href="../reference/rotate_markers.html">rotate_markers</a></span><span class="op">(</span><span class="va">.</span>, angle_deg <span class="op">=</span> <span class="fl">90</span>, axis <span class="op">=</span> <span class="st">"z"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="co">#rotate anti-clockwise around x axis</span></span>
<span>  <span class="fu"><a href="../reference/rotate_markers.html">rotate_markers</a></span><span class="op">(</span><span class="va">.</span>, angle_deg <span class="op">=</span> <span class="fl">90</span>, axis <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#visualise to check correct rotation</span></span>
<span><span class="fu"><a href="../reference/visualise_3D_marker_position.html">visualise_3D_marker_position</a></span><span class="op">(</span><span class="va">df_rotated</span>, selected_frame <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="plotly html-widget html-fill-item" id="htmlwidget-e5c8c404fe174e4c81bd" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"visdat":{"42a05cc83774":["function () ","plotlyVisDat"]},"cur_data":"42a05cc83774","attrs":{"42a05cc83774":{"x":{},"y":{},"z":{},"hoverinfo":"text+x+z+y","mode":"markers","text":{},"marker":{"size":3,"color":"#024950"},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Anterior-Posterior","range":[-120.29093170165996,1412.03784179688]},"yaxis":{"title":"Mediolateral","range":[1412.03784179688,-120.29093170165996]},"zaxis":{"title":"Vertical","range":[-120.29093170165996,1412.03784179688]},"aspectmode":"cube"},"title":"3D Marker Positions at Frame = 1","hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[156.43150329589804,310.48590087890602,113.78587341308601,305.8115234375,307.44198608398398,141.16725158691401,140.52172851562503,222.37440490722699,244.06571960449199,219.17793273925801,289.45220947265602,246.64465332031301,217.74491882324202,244.63612365722702,219.28791809082003,253.13104248046903,289.64440917968807,197.00053405761699,270.55255126953102,193.930740356445,256.62149047851602,257.42620849609398,218.81057739257801,153.14454650878901,233.98571777343801,156.48066711425801,217.30862426757801,201.59925842285199,182.16773986816401,117.186897277832,111.81329345703099,144.31982421875,132.94874572753901,243.883712768555,277.57638549804699,221.211669921875,328.52151489257801,335.92050170898398,316.09970092773398,374.5380859375,175.03112792968804,244.29455566406304,181.15765380859403,239.72515869140602,246.56320190429702,217.20491027832003,141.92227172851602,204.34007263183602,135.68739318847702,207.55572509765602,202.58120727539102,175.18406677246102,120.55532073974602,113.28782653808602,159.95495605468804,142.09500122070304,241.91552734375003,280.81246948242199,225.15718078613304,319.08917236328102,328.90887451171898,294.73236083984398,373.32669067382801],"y":[238.25479125976608,235.24496459960906,237.01898193359409,116.77445220947304,335.98495483398403,186.92631530761705,268.10653686523403,55.517581939697273,58.519828796386747,-38.932117462158246,-120.29093170165996,-60.575012207031257,421.04357910156307,414.08761596679705,520.30938720703114,519.73907470703102,588.47613525390602,55.533702850341825,40.666255950927727,61.859527587890618,43.265460968017621,176.39555358886699,60.875759124755916,45.855239868164112,46.946960449218807,47.146755218505909,48.816547393798899,139.54537963867199,49.983097076415994,101.36307525634798,97.498970031738295,138.67967224121099,56.67504119873049,138.42251586914097,88.612152099609389,33.348724365234396,119.49662780761699,86.237030029296889,21.763154983520486,80.74881744384767,390.03793334961006,419.02359008789108,406.19113159179705,419.68347167968807,291.99075317382807,407.27233886718807,407.132904052735,423.40570068359398,388.61358642578102,411.31622314453102,317.13037109375,402.02996826171898,349.5078125,352.38031005859398,305.35443115234398,396.33352661132801,312.27658081054699,362.808837890625,416.69842529296898,325.21231079101602,369.29367065429699,433.21539306640602,371.318603515625],"z":[1412.03784179688,1355.09265136719,1256.25268554688,946.86315917968795,949.48553466796898,970.767333984375,967.881591796875,1398.58557128906,1082.09765625,1124.66320800781,911.07092285156295,873.24493408203205,1382.70532226562,1063.12915039062,1093.96459960938,848.03656005859398,879.86267089843795,701.79016113281295,700.12951660156295,597.67053222656295,611.81024169921898,480.51205444336,502.75552368164102,309.53164672851602,297.77801513671898,248.29714965820301,220.15455627441401,113.99597167968798,101.20957183837901,79.986717224121094,49.221130371093793,49.592823028564496,44.946666717529297,88.507293701171889,109.901802062988,84.849037170410199,62.235408782958991,74.757759094238295,59.005619049072301,68.022621154785199,711.35925292968795,708.49938964843795,625.92706298828102,603.06359863281295,484.42889404296898,494.01553344726602,271.75967407226602,287.07168579101602,210.99147033691398,206.94834899902398,121.56436920165999,109.54668426513697,84.051643371582074,47.884109497070277,39.731842041015682,47.443809509277379,87.916534423828182,108.60043334960898,84.176170349121165,65.116188049316392,77.334030151367173,46.24366760253907,71.239822387695369],"hoverinfo":["text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y"],"mode":"markers","text":["C7","Sternum","MidT","L.ASIS","R.ASIS","L.PSIS","R.PSIS","L.Acromion","L.Elbow.Med","L.Elbow.Lat","L.Radius","L.Ulna","R.Acromion","R.Elbow.Med","R.Elbow.Lat","R.Ulna","R.Radius","L.Thigh.Post.Sup","L.Thigh.Ant.Sup","L.Thigh.Post.Inf","L.Thigh.Ant.Inf","L.Knee.Med","L.Knee.Lat","L.Shank.Post.Sup","L.Shank.Ant.Sup","L.Shank.Post.Inf","L.Shank.Ant.Inf","L.Ankle.Med","L.Ankle.Lat","L.Heel.Sup","L.Heel.Inf","L.Heel. Med","L.Heel.Lat","L.Midfoot.Med","L.Midfoot.Int","L.Midfoot.Lat","L.MTP1","L.MTP2","L.MTP5","L.Toe","R.Thigh.Post.Sup","R.Thigh.Ant.Sup","R.Thigh.Post.Inf","R.Thigh.Ant.Inf","R.Knee.Med","R.Knee.Lat","R.Shank.Post.Sup","R.Shank.Ant.Sup","R.Shank.Post.Inf","R.Shank.Ant.Inf","R.Ankle.Med","R.Ankle.Lat","R.Heel.Sup","R.Heel.Inf","R.Heel.Med","R.Heel.Lat","R.Midfoot.Med","R.Midfoot.Int","R.Midfoot.Lat","R.MTP1","R.MTP2","R.MTP5","R.Toe"],"marker":{"color":"#024950","size":3,"line":{"color":"rgba(31,119,180,1)"}},"type":"scatter3d","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script><p>The <code><a href="../reference/rotate_markers.html">rotate_markers()</a></code> function takes a data.frame of
marker trajectories (from <code><a href="../reference/read_trc.html">read_trc()</a></code>) and rotates around
specified axes by a specified amount. For intuition around the rotation,
first recognise that a clockwise rotation around an axis that is
pointing to you would be negative. Therefore, rotating our data from
positive y-axis = forward (i.e., Vicon system) to positive x-axis =
forward (i.e., OpenSim system) could be achieved in multiple ways, one
being two anti-clockwise rotations of 90 degrees, from the z- then the
x-axis.</p>
</div>
<div class="section level2">
<h2 id="filter">Filter<a class="anchor" aria-label="anchor" href="#filter"></a>
</h2>
<p>We often filter our marker data to smooth it. This won’t make a big
difference in this case as it is a static trial, but the same function
(<code><a href="../reference/filter_lowpass_pad_df.html">filter_lowpass_pad_df()</a></code>) can be used for any .trc data.
Note that the functions also pads the signal by a specified amount on
either side prior to filtering, then removes that padding after. This
helps to remove artefact from entering your data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#now lets add filtering (won't change much since this is static)</span></span>
<span><span class="va">df_filtered</span> <span class="op">=</span> </span>
<span>  </span>
<span>  <span class="co">#get the rotated data</span></span>
<span>  <span class="va">df_rotated</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="co">#filter with zero-lag 4th order Butterworth filter (cutoff = 6Hz)</span></span>
<span>  <span class="fu"><a href="../reference/filter_lowpass_pad_df.html">filter_lowpass_pad_df</a></span><span class="op">(</span><span class="va">.</span>, </span>
<span>                        time_col <span class="op">=</span> <span class="st">"Time"</span>,</span>
<span>                        exclude_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="co">#don't filter the Frame and Time data </span></span>
<span>                               cut_off <span class="op">=</span> <span class="fl">6</span>, <span class="co">#in Hz</span></span>
<span>                               sample_rate <span class="op">=</span> <span class="fl">200</span>, <span class="co">#in Hz</span></span>
<span>                               order <span class="op">=</span> <span class="fl">2</span>, <span class="co">#zero-lag filter, so the order doubles to 4</span></span>
<span>                               pad_time <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="co">#pad data by 500ms either side to avoid artefacts</span></span></code></pre></div>
<p>Choosing an appropriate filter is another discussion, but for
context, a low-pass Butterworth filter with a cut-off of 6-15Hz is
fairly typical.</p>
</div>
<div class="section level2">
<h2 id="joint-centres">Joint centres<a class="anchor" aria-label="anchor" href="#joint-centres"></a>
</h2>
<p>For static trials, we often want to compute joint centres. The
following demonstrates how to compute the hip joint centre using
regression equations (either “harrington” or “bell” can be specified),
or a mid-point method for the knee ankle.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#finally, let's compute joint centres</span></span>
<span><span class="va">df_processed</span> <span class="op">=</span> </span>
<span>  </span>
<span>  <span class="co">#get the filtered data</span></span>
<span>  <span class="va">df_filtered</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="co">#compute hip joint centres</span></span>
<span>  <span class="fu"><a href="../reference/compute_hjc_regression.html">compute_hjc_regression</a></span><span class="op">(</span><span class="va">.</span>,</span>
<span>                         LASIS_name <span class="op">=</span> <span class="st">"L.ASIS"</span>,</span>
<span>                         RASIS_name <span class="op">=</span> <span class="st">"R.ASIS"</span>,</span>
<span>                         LPSIS_name <span class="op">=</span> <span class="st">"L.PSIS"</span>,</span>
<span>                         RPSIS_name <span class="op">=</span> <span class="st">"R.PSIS"</span>,</span>
<span>                         RHJC_name <span class="op">=</span> <span class="st">"R.HJC"</span>,</span>
<span>                         LHJC_name <span class="op">=</span> <span class="st">"L.HJC"</span>,</span>
<span>                         method <span class="op">=</span> <span class="st">"harrington"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="co">#most accurate regression method</span></span>
<span>  </span>
<span>  <span class="co">#compute knee joint centres</span></span>
<span>  <span class="fu"><a href="../reference/compute_jc_mid.html">compute_jc_mid</a></span><span class="op">(</span><span class="va">.</span>, </span>
<span>                 marker_name_1 <span class="op">=</span> <span class="st">"L.Knee.Med"</span>, </span>
<span>                 marker_name_2 <span class="op">=</span> <span class="st">"L.Knee.Lat"</span>, </span>
<span>                 jc_name <span class="op">=</span> <span class="st">"L.Knee"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/compute_jc_mid.html">compute_jc_mid</a></span><span class="op">(</span><span class="va">.</span>, </span>
<span>                 marker_name_1 <span class="op">=</span> <span class="st">"R.Knee.Med"</span>, </span>
<span>                 marker_name_2 <span class="op">=</span> <span class="st">"R.Knee.Lat"</span>, </span>
<span>                 jc_name <span class="op">=</span> <span class="st">"R.Knee"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="co">#compute ankle joint centres</span></span>
<span>  <span class="fu"><a href="../reference/compute_jc_mid.html">compute_jc_mid</a></span><span class="op">(</span><span class="va">.</span>, </span>
<span>                 marker_name_1 <span class="op">=</span> <span class="st">"L.Ankle.Med"</span>, </span>
<span>                 marker_name_2 <span class="op">=</span> <span class="st">"L.Ankle.Lat"</span>, </span>
<span>                 jc_name <span class="op">=</span> <span class="st">"L.Ankle"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/compute_jc_mid.html">compute_jc_mid</a></span><span class="op">(</span><span class="va">.</span>, </span>
<span>                 marker_name_1 <span class="op">=</span> <span class="st">"R.Ankle.Med"</span>, </span>
<span>                 marker_name_2 <span class="op">=</span> <span class="st">"R.Ankle.Lat"</span>, </span>
<span>                 jc_name <span class="op">=</span> <span class="st">"R.Ankle"</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Loading required package: pracma</span></span>
<span><span class="co">#&gt; Warning: package 'pracma' was built under R version 4.2.3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'pracma'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:magrittr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     and, mod, or</span></span>
<span></span>
<span><span class="co">#re-visualise, which should show the new joint centre markers</span></span>
<span><span class="fu"><a href="../reference/visualise_3D_marker_position.html">visualise_3D_marker_position</a></span><span class="op">(</span><span class="va">df_processed</span>, selected_frame <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="plotly html-widget html-fill-item" id="htmlwidget-36aa3d2a04d42bbc2145" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-36aa3d2a04d42bbc2145">{"x":{"visdat":{"42a03bcb3cc2":["function () ","plotlyVisDat"]},"cur_data":"42a03bcb3cc2","attrs":{"42a03bcb3cc2":{"x":{},"y":{},"z":{},"hoverinfo":"text+x+z+y","mode":"markers","text":{},"marker":{"size":3,"color":"#024950"},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Anterior-Posterior","range":[-120.27980102723862,1412.0418653380402]},"yaxis":{"title":"Mediolateral","range":[1412.0418653380402,-120.27980102723862]},"zaxis":{"title":"Vertical","range":[-120.27980102723862,1412.0418653380402]},"aspectmode":"cube"},"title":"3D Marker Positions at Frame = 1","hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[156.42519843714888,310.48613304647893,113.76794246774689,305.80875780778501,307.4187032680876,141.14389034871391,140.50259773818294,222.37105963900095,244.08474405629602,219.18187487615214,289.48336662292104,246.64907671870742,217.75451090616124,244.62718520409786,219.28208707969367,253.12557188881465,289.64107146375574,196.99862251850163,270.43567492990388,193.93234157078837,256.6294634190611,257.42286713584639,218.81197110862271,153.13155417559366,233.9768437962318,156.49944841593555,217.297746183539,201.6011881802481,182.164770352407,117.16607674613252,111.79811869161668,144.31462001660444,132.94093304593446,243.88469279871123,277.58682580174849,221.20899604342799,328.51221276747333,335.92376907942179,316.11132028115293,374.52860491850419,175.42199029022328,244.30087445758619,181.0575024917101,239.77618506576556,246.45495412487193,217.21192821077028,141.89367475285155,204.36477165099009,135.5812597852792,207.52104479999815,202.58854244156308,175.19075679894999,120.55289849860145,113.27223466749763,159.94658688068398,142.09032081842062,241.89690545559409,280.81380148161281,225.15709821351831,319.07386902611904,328.89987498172036,294.73060513078292,373.31885146879671,247.88968071129187,246.71989737277028,238.11741912223454,231.83344116782109,191.88297926632754,188.88964962025653],"y":[238.24900410051026,235.25276922694064,237.02405267149817,116.78338444125183,335.98736167986482,186.93736982753427,268.12052712893308,55.521572660263722,58.533676081140229,-38.919972923003471,-120.27980102723862,-60.589871687684408,421.04687169826121,414.09364734037797,520.33172115424554,519.75541721425634,588.48669436733121,55.578065769877306,40.753552883654308,61.864987732990159,43.287525138157584,176.39110238145082,60.889327364848057,45.851046814608537,46.945548467691175,47.172559599104773,48.816686644977224,139.55473402411553,49.991094791838165,101.36520928068352,97.50782474495017,138.68939417048676,56.663968900392526,138.43169540146027,88.608658224126842,33.354164331610001,119.49885234995448,86.2301393205598,21.782433458705757,80.753351684256728,389.74695427309399,419.02891055022911,406.33473554097503,419.69634017525971,292.00987360823081,407.27883285771514,407.1280823394161,423.33397164538377,388.78397046466688,411.32337842947715,317.13438459089662,401.99829847349582,349.52453077263971,352.38316399135755,305.36504914694785,396.33733436548562,312.28932317977427,362.81289118036369,416.63141581531818,325.21740160956676,369.29558453020934,433.22104031531876,371.32429524123586,307.28747013249233,148.01427322357097,118.64021487314943,349.644353232973,94.772914407976856,359.56634153219625],"z":[1412.0418653380402,1355.0920428504617,1256.2606404003905,946.86367443526854,949.4731477826017,970.76191053467778,967.89350331442176,1398.5809690453443,1082.1029994493445,1124.6822416932773,911.08278825705634,873.25660528556614,1382.714438223579,1063.1418993917268,1093.9840829426587,848.05260911489802,879.86818056430502,701.78130605380807,700.19795899710857,597.64748939966762,611.82325492456403,480.51326134051379,502.75726169047232,309.53440070707188,297.78225329750353,248.26334352385484,220.14934511036779,114.00420324668204,101.20460292834839,79.969143532820681,49.214725181700409,49.599749839088119,44.950281762833981,88.50394268815235,109.89835878878975,84.847251691800466,62.231890616956861,74.749680086214454,59.012299949848213,68.026402851155865,711.25746018867949,708.49876959478979,625.95307191892562,603.08637452031803,484.43122736584201,494.01021341692609,271.76795119232912,287.07859079299755,210.97004998882966,206.95591376934627,121.56342308599413,109.55124261805071,84.062737534364345,47.8901985994342,39.746552026976083,47.456056628825309,87.945902894307736,108.60435090041949,84.197812212287019,65.113820327102317,77.329748151987417,46.242854364331563,71.234829426497612,879.40191523809574,877.50587681984223,491.63526151549308,489.22072039138402,107.60440308751521,115.55733285202243],"hoverinfo":["text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y","text+x+z+y"],"mode":"markers","text":["C7","Sternum","MidT","L.ASIS","R.ASIS","L.PSIS","R.PSIS","L.Acromion","L.Elbow.Med","L.Elbow.Lat","L.Radius","L.Ulna","R.Acromion","R.Elbow.Med","R.Elbow.Lat","R.Ulna","R.Radius","L.Thigh.Post.Sup","L.Thigh.Ant.Sup","L.Thigh.Post.Inf","L.Thigh.Ant.Inf","L.Knee.Med","L.Knee.Lat","L.Shank.Post.Sup","L.Shank.Ant.Sup","L.Shank.Post.Inf","L.Shank.Ant.Inf","L.Ankle.Med","L.Ankle.Lat","L.Heel.Sup","L.Heel.Inf","L.Heel. Med","L.Heel.Lat","L.Midfoot.Med","L.Midfoot.Int","L.Midfoot.Lat","L.MTP1","L.MTP2","L.MTP5","L.Toe","R.Thigh.Post.Sup","R.Thigh.Ant.Sup","R.Thigh.Post.Inf","R.Thigh.Ant.Inf","R.Knee.Med","R.Knee.Lat","R.Shank.Post.Sup","R.Shank.Ant.Sup","R.Shank.Post.Inf","R.Shank.Ant.Inf","R.Ankle.Med","R.Ankle.Lat","R.Heel.Sup","R.Heel.Inf","R.Heel.Med","R.Heel.Lat","R.Midfoot.Med","R.Midfoot.Int","R.Midfoot.Lat","R.MTP1","R.MTP2","R.MTP5","R.Toe","R.HJC","L.HJC","L.Knee","R.Knee","L.Ankle","R.Ankle"],"marker":{"color":"#024950","size":3,"line":{"color":"rgba(31,119,180,1)"}},"type":"scatter3d","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script><p>This step is not needed for all trial types, but is important for
static trials that we use for scaling models.</p>
</div>
<div class="section level2">
<h2 id="write">Write<a class="anchor" aria-label="anchor" href="#write"></a>
</h2>
<p>Finally, we can write our processed marker data to file for
subsequent analysis.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#then write to file</span></span>
<span><span class="fu"><a href="../reference/write_trc.html">write_trc</a></span><span class="op">(</span><span class="va">df_processed</span>, unit <span class="op">=</span> <span class="st">"mm"</span>, <span class="st">"./data/static_processed.trc"</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dr Nirav Maniar.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
